From 027032af2c9ab49b7cb7872ec5b8ac97603c328b Mon Sep 17 00:00:00 2001
From: olegsvs <oleg.texet@gmail.com>
Date: Wed, 11 May 2016 02:02:26 +0300
Subject: [PATCH 1106/1168] pocket_mod button wakeup bug 12/

---
 .../touchscreen/mediatek/GT915_HD/gt9xx_driver.c   | 80 +++++++---------------
 .../jd9367_6735_dsi_video/jd9367_6735_dsi_video.c  |  4 ++
 include/generated/compile.h                        |  4 +-
 3 files changed, 30 insertions(+), 58 deletions(-)

diff --git a/drivers/input/touchscreen/mediatek/GT915_HD/gt9xx_driver.c b/drivers/input/touchscreen/mediatek/GT915_HD/gt9xx_driver.c
index 387ba64..ac591c0 100755
--- a/drivers/input/touchscreen/mediatek/GT915_HD/gt9xx_driver.c
+++ b/drivers/input/touchscreen/mediatek/GT915_HD/gt9xx_driver.c
@@ -79,6 +79,14 @@
 #include <linux/sensors_io.h>
 #endif
 
+#ifdef CONFIG_POCKETMOD
+#include <linux/pocket_mod.h>
+#endif
+
+#ifdef CONFIG_TOUCHSCREEN_DOUBLETAP2WAKE
+#include <linux/input/doubletap2wake.h>
+#endif
+
 #if GTP_SUPPORT_I2C_DMA
     #include <linux/dma-mapping.h>
 #endif
@@ -2669,46 +2677,7 @@ static int touch_event_handler(void *unused)
 
         if (key_value || pre_key)
         {
-        #if GTP_PEN_HAVE_BUTTON
-            if (key_value == 0x40)
-            {
-                GTP_DEBUG("BTN_STYLUS & BTN_STYLUS2 Down.");
-                input_report_key(pen_dev, BTN_STYLUS, 1);
-                input_report_key(pen_dev, BTN_STYLUS2, 1);
-                pen_active = 1;
-            }
-            else if (key_value == 0x10)
-            {
-                GTP_DEBUG("BTN_STYLUS Down, BTN_STYLUS2 Up.");
-                input_report_key(pen_dev, BTN_STYLUS, 1);
-                input_report_key(pen_dev, BTN_STYLUS2, 0);
-                pen_active = 1;
-            }
-            else if (key_value == 0x20)
-            {
-                GTP_DEBUG("BTN_STYLUS Up, BTN_STYLUS2 Down.");
-                input_report_key(pen_dev, BTN_STYLUS, 0);
-                input_report_key(pen_dev, BTN_STYLUS2, 1);
-                pen_active = 1;
-            }
-            else
-            {
-                GTP_DEBUG("BTN_STYLUS & BTN_STYLUS2 Up.");
-                input_report_key(pen_dev, BTN_STYLUS, 0);
-                input_report_key(pen_dev, BTN_STYLUS2, 0);
-                if ( (pre_key == 0x40) || (pre_key == 0x20) ||
-                     (pre_key == 0x10) 
-                   )
-                {
-                    pen_active = 1;
-                }
-            }
-            if (pen_active)
-            {
-                touch_num = 0;      // shield pen point
-                //pre_touch = 0;    // clear last pen status
-            }
-        #endif
+      
         #if GTP_HAVE_TOUCH_KEY
             if (!pre_touch)
             {
@@ -2740,23 +2709,22 @@ static int touch_event_handler(void *unused)
                 input_x = TPD_WARP_X(abs_x_max, input_x);
                 input_y = TPD_WARP_Y(abs_y_max, input_y);
 
-            #if GTP_WITH_PEN
-                id = coor_data[0];
-                if ((id & 0x80))      // pen/stylus is activated
-                {
-                    GTP_DEBUG("Pen touch DOWN!");
-                    pre_pen = 1;
-                    //id &= 0x7F;
-                    id = 0;
-                    GTP_DEBUG("(%d)(%d, %d)[%d]", id, input_x, input_y, input_w);
-                    gtp_pen_down(input_x, input_y, input_w, id);
-                    pen_active = 1;
-                }
-                else
-            #endif
+
                 {
-                    GTP_DEBUG(" (%d)(%d, %d)[%d]", id, input_x, input_y, input_w);
-                    tpd_down(input_x, input_y, input_w, id);
+
+#ifdef CONFIG_TOUCHSCREEN_DOUBLETAP2WAKE
+			// fix for lower button wakeup
+			if(dt2w_scr_suspended == false) 
+				{
+				tpd_down( input_x, input_y, 0, 0);
+				}
+				else if(touch_key_point_maping_array[i].point_y<1280) {
+					tpd_down( input_x, input_y, 0, 0);
+				}
+			#else
+				tpd_down( input_x, input_y, 0, 0);
+				GTP_DEBUG("button =%d %d",input_x,input_y);
+			#endif
                 }
             }
         }
diff --git a/drivers/misc/mediatek/lcm/jd9367_6735_dsi_video/jd9367_6735_dsi_video.c b/drivers/misc/mediatek/lcm/jd9367_6735_dsi_video/jd9367_6735_dsi_video.c
index 62e15c4..82c3302 100644
--- a/drivers/misc/mediatek/lcm/jd9367_6735_dsi_video/jd9367_6735_dsi_video.c
+++ b/drivers/misc/mediatek/lcm/jd9367_6735_dsi_video/jd9367_6735_dsi_video.c
@@ -76,6 +76,10 @@
 #include <mach/mt_pm_ldo.h>
 #endif
 
+#ifdef CONFIG_DOUBLETAP2WAKE
+#include <linux/input/doubletap2wake.h>
+#endif
+
 #ifdef CONFIG_POCKETMOD
 #include <linux/pocket_mod.h>
 #endif
diff --git a/include/generated/compile.h b/include/generated/compile.h
index c3721a9..fde12a6 100644
--- a/include/generated/compile.h
+++ b/include/generated/compile.h
@@ -1,7 +1,7 @@
-/* This file is auto generated, version 37 */
+/* This file is auto generated, version 38 */
 /* SMP PREEMPT */
 #define UTS_MACHINE "arm64"
-#define UTS_VERSION "#37 SMP PREEMPT Wed May 11 00:31:27 MSK 2016"
+#define UTS_VERSION "#38 SMP PREEMPT Wed May 11 01:23:00 MSK 2016"
 #define LINUX_COMPILE_BY "olegsvs"
 #define LINUX_COMPILE_HOST "olegsvs-develop"
 #define LINUX_COMPILER "gcc version 4.9 20150123 (prerelease) (GCC) "
-- 
2.7.4

